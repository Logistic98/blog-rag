## 5. Docker搭建中间件服务
### 5.2 Docker-Nginx环境搭建
#### 5.2.4 搭建过程踩的坑

**[1] 非安全端口问题**

情景描述：搭建完的nginx在本地用`curl IP:port`可以访问（当然在nginx容器里使用`curl 127.0.0.1`也是可以访问的），但在浏览器内找不到该地址（提示“该网页可能已永久移到新的网址”）。

错误原因：创建nginx容器时误用了Chrome浏览器的默认非安全端口，访问会直接被拦截，因而出现了该情况。Chrome 默认非安全端口列表如下：

```
1, 7, 9, 11, 13, 15, 17, 19, 20, 21, 22, 23, 25, 37, 42, 43, 53, 77, 79, 87, 95, 101, 102, 103, 104, 109, 110, 111, 113, 115, 117, 119, 123, 135, 139, 143, 179, 389, 465, 512, 513, 514, 515, 526, 530, 531, 532, 540, 556, 563, 587, 601, 636, 993, 995, 2049, 3659, 4045, 6000, 6665, 6666, 6667, 6668, 6669
```

解决办法：删掉nginx容器重新搭建，创建nginx容器时避开Chrome浏览器的默认非安全端口即可。

**[2] 访问资源403问题**

情景描述：部署的项目有上传文件功能，上传成功后要在网页上进行显示，但该资源却403无权限访问，改目录权限777虽然可以临时使其可以访问，但后续上传的文件又权限不足。

错误原因：启动nginx的用户没有该资源的访问权限

解决办法：修改nginx的启动用户为root，访问权限就有了。

```shell
$ vim /etc/nginx/nginx.conf    // 把第一行的用户配置改成“user  root;”
```
